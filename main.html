<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="utf-8">
  <title>Paystem Firebase</title>

  <style>
    @font-face{font-family:MyFont;src:url('font.ttf')}
    html,body{
      margin:0;padding:0;height:100%;overflow:hidden;
      background:url("https://supeewwwwclickyyyyree.vercel.app/orqa.gif") no-repeat center center fixed;
      background-size:cover;
    }
    #savedText{
      position:absolute;top:299px;left:40%;transform:translateX(-50%);
      color:#fff;font-size:74px;font-family:MyFont,sans-serif;
      white-space:nowrap;z-index:5;
    }
  </style>

  <!-- Faqat BIRTA script – to‘g‘ri yuklanadi -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase.js"></script>
</head>
<body>
  <div id="savedText"></div>

  <script>
    // --- Firebase config ---
    var firebaseConfig = {
      apiKey: "AIzaSyB1tOSO0cP9aYfIg3O8MR9jL2V-f9AtINo",
      authDomain: "myhack-6a419.firebaseapp.com",
      databaseURL: "https://myhack-6a419-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "myhack-6a419",
      storageBucket: "myhack-6a419.firebasestorage.app",
      messagingSenderId: "322530645019",
      appId: "1:322530645019:android:14828ec66d3551173814be"
    };

    firebase.initializeApp(firebaseConfig);
    var db = firebase.database(); // TO‘LIQ ISHLAYDI

    function formatNumber(num){
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
    }

    var nodePath = "paystem";
    var threeHoursMs = 3 * 60 * 60 * 1000;

    function showValue(v){
      document.getElementById("savedText").innerText = v;
    }

    function fallbackRandom(){
      var r = Math.floor(Math.random() * (7000000 - 3000000 + 1)) + 3000000;
      showValue(formatNumber(r) + " so'm");
    }

    function loadOrGenerate(){
      db.ref(nodePath).once("value").then(function(snapshot){
        var now = Date.now();

        if(snapshot.exists()){
          var data = snapshot.val();
          if(data.time && (now - data.time) < threeHoursMs){
            showValue(data.value);
            return;
          }
        }

        var rand = Math.floor(Math.random()*(7000000-3000000+1))+3000000;
        var value = formatNumber(rand) + " so'm";

        db.ref(nodePath).set({ value:value, time:now })
          .then(function(){ showValue(value); })
          .catch(function(){ fallbackRandom(); });

      }).catch(function(){
        fallbackRandom();
      });
    }

    window.onload = loadOrGenerate;
  </script>
</body>
</html>
